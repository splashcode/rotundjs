;(function(){var e="http://www.w3.org/2000/svg";var c={each:function(j,l,g){if(c.isArray(j)){if(Array.prototype.forEach){j.forEach(l,g)}else{for(var f=0,h=j.length;f<h;f++){l.call(g,j[f],f)}}}else{if(this.isObject(j)){for(var k in j){l.call(g,j[k],k)}}}},extend:function(f){c.each(Array.prototype.slice.call(arguments).slice(1),function(g){c.each(g,function(i,h){if(c.isObject(i)){f[h]=c.extend(f[h],i)}else{f[h]=i}})});return f},filter:function(h,g){var f=[];c.each(h,function(i){if(g(i)){f.push(i)}});return f},isArray:Array.isArray||function(f){return(f&&(Object.prototype.toString.call(f)==="[object Array]"))},isFunction:function(f){return(f&&(typeof f==="function"))},isObject:function(f){return(f&&(Object.prototype.toString.call(f)==="[object Object]"))},isString:function(f){return typeof f==="string"},compileTemplate:function(g,f){c.each(f,function(i,h){g=g.replace("{{"+h+"}}",i,"gi")});return g}};var b=function(){this.list=[]};b.prototype={add:function(f){this.list.push(f)},each:function(g,f){c.each(this.list,g,f)},filter:function(f){return c.filter(this.list,f)},sum:function(g){var f=0;this.each(function(h){f+=h[g]});return f},length:function(){return this.list.length}};var a=function(){this.subscribers=[]};a.prototype={publish:function(g,f){c.each(this.subscribers[g],function(h){h(f)})},subscribe:function(f,g){if(this.subscribers[f]===undefined){this.subscribers[f]=[]}this.subscribers[f].push(g)}};var d=function(u){var p=function(){b.call(this)};p.prototype=new b();p.prototype.constructor=p;var k=function(v,w){b.call(this);this.id=w;this.name=v||"A serie";this.percentage=null;this.prettyPercentage=null;this.list=[]};k.prototype=c.extend(new b(),{constructor:k,getRadius:function(){return(((u.width<u.height)?u.width:u.height)/2)-(((u.seriesOptions.size+u.seriesOptions.margin)*(this.id+1))-(u.seriesOptions.size/2))}});var g=function(w,x,v){if(w===null||x===null){throw new Error("Name and value must be define for every point.")}this.name=w;this.value=x;this.percentage=null;this.prettyPercentage=null;this.color=v||this.generateColor()};g.prototype={generateColor:function(){var w=m[this.name];if(w===undefined){var x=Math.floor((n*360)/16),v=65-(10*(Math.floor(n/16)));n++;w="hsl("+x+", 90%, "+v+"%)";m[this.name]=w}return w}};var o=function(v){this.form=v;this.elt=document.createElementNS(e,v);this.style={}};o.prototype={setStyle:function(v){this.style=c.extend(this.style,v);this.elt.setAttribute("style",this._styleToString())},_styleToString:function(){var v="";c.each(this.style,function(x,w){if(x!==null){v+=w+":"+x+";"}});return v}};var j=function(w,v){this.container=document.createElementNS(e,"svg");this.container.setAttribute("xmlns",e);this.container.setAttribute("width",w);this.container.setAttribute("height",v);this.container.style.position="relative";this.center={x:w/2,y:v/2}};j.prototype={paint:function(v){var w=new o(v.markup,v.type);w.setStyle(v.style);c.each(v.attributes,function(y,x){w.elt.setAttribute(x,y)});if(c.isFunction(v.mouseover)){w.elt.addEventListener("mouseover",v.mouseover,false)}if(c.isFunction(v.mouseout)){w.elt.addEventListener("mouseout",v.mouseout,false)}this.container.appendChild(w.elt);return w}};j.isSvgSupported=function(){return(document.createElementNS&&document.createElementNS(e,"svg"))?true:false};var r=function(){this.bkgCircle=null;this.text=document.createElement("div");this.radius=null;this.text.setAttribute("class","rotundTooltipText");this.text.style.font=u.tooltip.font;this.text.style.color=u.tooltip.color;f.appendChild(this.text);var v=this;q.subscribe("tooltipShowMyText",function(w){v.setText(w)})};r.prototype={init:function(w,v){this.bkgCircle=w;this.setText(u.tooltip.defaultText);if(!v){this.bkgCircle.setStyle({display:"none"});this.text.style.display="none"}},getRadius:function(){if(this.radius===null){this.radius=(((u.width<u.height)?u.width:u.height)/2)-(((u.seriesOptions.size+u.seriesOptions.margin)*h.length())+u.seriesOptions.margin)}return this.radius},setText:function(v){this.text.innerHTML=v;this.text.style.maxWidth=this.text.style.maxHeight=this.getRadius()*2+"px";this.text.style.marginTop="-"+(this.text.offsetHeight/2)+"px";this.text.style.marginLeft="-"+(this.text.offsetWidth/2)+"px"}};var l={container:null,width:300,height:300,tooltip:{visible:true,template:"<b>{{name}}</b><hr/>{{value}}",defaultText:null,backgroundColor:"none",font:"1em/1.4em 'Trebuchet MS', 'Lucida San', 'Lucida Grande', 'Lucida Sans Unicode', sans-sherif",color:"#444"},series:[[]],seriesOptions:{colors:[],size:20,margin:5}};u=c.extend(l,u,10);u.width=parseInt(u.width,10);u.height=parseInt(u.height,10);u.seriesOptions.size=parseInt(u.seriesOptions.size,10);u.seriesOptions.margin=parseInt(u.seriesOptions.margin,10);var f=document.getElementById(u.container);f.style.position="relative";f.style.width=u.width+"px";f.style.height=u.height+"px";if(j.isSvgSupported()){f.innerHTML="<style>#"+u.container+" .rotundArc{-moz-transition : opacity 0.4s ease;-webkit-transition : opacity 0.4s ease;-o-transition : opacity 0.4s ease;-ms-transition : opacity 0.4s ease;transition : opacity 0.4s ease;}#"+u.container+" .rotundTooltipText{position : absolute;top : 50%;left : 50%;text-align : center;z-index : 2;}</style>";var m={};var n=0;var q=new a();var h=new p();var s=0;c.each(u.series,function(x,v){var w=new k(x.name,v);c.each(x.data,function(A){var y=A.color;if(y==null&&u.seriesOptions.colors.length>0){y=u.seriesOptions.colors[0];u.seriesOptions.colors.shift()}var z=new g(A.name,A.value,y);s+=z.value;w.add(z)});h.add(w)});h.each(function(v){var w=v.sum("value");v.percentage=Math.min((w/s)*100,100);v.prettyPercentage=Math.round(v.percentage);v.each(function(x){x.percentage=Math.min((x.value/s)*100,100);x.prettyPercentage=Math.round(x.percentage)})});var i=new j(u.width,u.height);h.each(function(x){var v=x.getRadius();var w=(-90/180)*Math.PI;x.each(function(z){z.textTooltip=c.compileTemplate(u.tooltip.template,{serie:x.name,name:z.name,value:z.value,percentage:z.prettyPercentage});var A=(((360*z.percentage)/100)/180)*Math.PI;var y={sx:i.center.x+(Math.cos(w)*v),sy:i.center.y+(Math.sin(w)*v),ex:i.center.x+(Math.cos(w+A)*v),ey:i.center.y+(Math.sin(w+A)*v)};z.form=i.paint({markup:"path",style:{fill:"none",stroke:z.color,"stroke-width":u.seriesOptions.size},attributes:{d:"M"+y.sx+","+y.sy+" A"+v+","+v+" 0 "+((z.percentage>50)?1:0)+",1 "+y.ex+","+y.ey,"class":"rotundArc"},mouseover:function(){z.overMe=true;q.publish("mouseoverForArc");q.publish("tooltipShowMyText",z.textTooltip)},mouseout:function(){z.overMe=false;setTimeout(function(){if(h.filter(function(B){return B.filter(function(C){return C.overMe}).length>0}).length===0){q.publish("mouseoutForArc");q.publish("tooltipShowMyText",u.tooltip.defaultText)}},250)}});q.subscribe("mouseoverForArc",function(){if(!z.overMe){z.form.setStyle({opacity:0.5})}else{z.form.setStyle({opacity:1})}});q.subscribe("mouseoutForArc",function(){if(!z.overMe){z.form.setStyle({opacity:1})}});w+=A})});var t=new r();t.init(i.paint({markup:"circle",style:{fill:u.tooltip.backgroundColor},attributes:{cx:i.center.x,cy:i.center.y,r:t.getRadius()}}),u.tooltip.visible);f.appendChild(i.container)}else{f.innerHTML="Your browser doesn't support SVG"}return{getSeries:function(){var v=[];c.each(h.list,function(w){var x={name:w.name,percentage:w.percentage,prettyPercentage:w.prettyPercentage,list:[]};c.each(w.list,function(y){x.list.push({name:y.name,color:y.color,value:y.value,percentage:y.percentage,prettyPercentage:y.prettyPercentage})});v.push(x)});return v}}};window.Rotund=d}());